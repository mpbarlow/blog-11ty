<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

    <!-- Feels like these should be CSS properties but okay -->
    <meta name="theme-color" content="rgb(243, 244, 246)" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="rgb(55, 65, 81)" media="(prefers-color-scheme: dark)" />

    <meta property="og:locale" content="en_GB" />
    <meta property="og:site_name" content="barlow.dev" />
    <meta property="og:url" content="https://barlow.dev/posts/modern-software-has-no-respect-for-disk-space/" />
    <meta property="og:title" content="Modern software has no respect for disk space - barlow.dev" />
    <meta property="og:type" content="blog" />
    

    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/prism-one-light.css" />
    <link rel="stylesheet" href="/css/prism-material-oceanic.css" />
    <link rel="icon" type="image/png" href="/img/favicon.png" />
    <link rel="canonical" href="https://barlow.dev/posts/modern-software-has-no-respect-for-disk-space/" />
    <link rel="alternate" type="application/atom+xml" href="https://barlow.dev/feed.xml" title="RSS Feed" />

    <title>Modern software has no respect for disk space - barlow.dev</title>
  </head>

  <body
    class="mx-auto grid min-h-dvh max-w-prose grid-cols-layout grid-rows-layout px-safe-offset-4 md:px-0 dark:bg-gray-800"
  >
    <nav class="mt-4 flex items-center justify-between dark:prose-invert">
      <a href="/" title="Home">
        <span class="font-mono text-indigo-500 dark:text-indigo-400">[barlow.dev ~] $</span>
      </a>
      <div class="space-x-2 sm:space-x-4">
        <a href="/posts/" class="text-indigo-500 dark:text-indigo-400">Posts</a>
        <a href="/tags/" class="text-indigo-500 dark:text-indigo-400">Tags</a>
        <a href="/feed.xml" class="text-indigo-500 dark:text-indigo-400">RSS</a>
      </div>
    </nav>

    <main class="mb-12 mt-8">
<article>
  <section class="prose dark:prose-invert">
    <h1 class="header-background">Modern software has no respect for disk space</h1>
    

    <aside class="not-prose text-sm text-gray-600 dark:text-gray-300">
      <p>7 minute read &bull; 24th May 2024</p>

      <div class="flex flex-wrap text-xs">
        
        <a
          href="/tags/apfs/"
          title="See all posts tagged 'apfs'"
          class="mr-1 mt-1 border border-gray-500 px-2 py-1 text-gray-500 shadow-hard shadow-gray-400 hover:border-indigo-500 hover:text-indigo-500 hover:shadow-indigo-400 dark:border-gray-300 dark:text-gray-300 dark:shadow-gray-500 dark:hover:border-indigo-400 dark:hover:text-indigo-400 dark:hover:shadow-indigo-500"
          >apfs</a
        >
        
        <a
          href="/tags/mac/"
          title="See all posts tagged 'mac'"
          class="mr-1 mt-1 border border-gray-500 px-2 py-1 text-gray-500 shadow-hard shadow-gray-400 hover:border-indigo-500 hover:text-indigo-500 hover:shadow-indigo-400 dark:border-gray-300 dark:text-gray-300 dark:shadow-gray-500 dark:hover:border-indigo-400 dark:hover:text-indigo-400 dark:hover:shadow-indigo-500"
          >mac</a
        >
        
        <a
          href="/tags/software/"
          title="See all posts tagged 'software'"
          class="mr-1 mt-1 border border-gray-500 px-2 py-1 text-gray-500 shadow-hard shadow-gray-400 hover:border-indigo-500 hover:text-indigo-500 hover:shadow-indigo-400 dark:border-gray-300 dark:text-gray-300 dark:shadow-gray-500 dark:hover:border-indigo-400 dark:hover:text-indigo-400 dark:hover:shadow-indigo-500"
          >software</a
        >
        
        <a
          href="/tags/timemachine/"
          title="See all posts tagged 'timemachine'"
          class="mr-1 mt-1 border border-gray-500 px-2 py-1 text-gray-500 shadow-hard shadow-gray-400 hover:border-indigo-500 hover:text-indigo-500 hover:shadow-indigo-400 dark:border-gray-300 dark:text-gray-300 dark:shadow-gray-500 dark:hover:border-indigo-400 dark:hover:text-indigo-400 dark:hover:shadow-indigo-500"
          >timemachine</a
        >
        
      </div>
    </aside>
  </section>

  <section class="prose prose-indigo mt-12 dark:prose-invert"><p>I feel like it’s sorta common knowledge today, especially if you’re a developer, that most modern software does not give the slightest shit about gobbling up as much RAM and as many CPU cycles as it wants. Developer time is more expensive than hardware; especially if it’s someone else’s hardware you’re spending. It sucks, but it’s a known quantity at this point. What I <em>was</em> somewhat surprised by recently is just how much of state things are in for disk hogging too.</p>
<p>My wife is considering upgrading her base M1 MacBook Air to something with a bit more oomph. It’s done an admirable job, but only having two USB ports is annoying if you don’t have a monitor with USB Power Delivery and/or ports of its own for peripherals, and 8GB RAM is becoming a bottleneck when she has lots of Chrome tabs and Office documents open. Ya know: completely normal, non-nerd stuff.</p>
<p>Apple’s pricing for storage is infamously price gouge-y, and we were looking at whether the extra £200 to jump from the 256GB storage she has now up to 512GB would be worth it, as her current machine only had about 20GB free.</p>
<p>I loaded up DaisyDisk (a fantastic and inexpensive little piece of software by the way, <a href="https://daisydiskapp.com">highly worth a look</a>), and here’s some of the stuff I found:</p>
<ul>
<li>Google Chrome.app was 8GB. Upon further investigation, inside the main bundle is another bundle called Google Chrome.framework, and inside <em>that</em> was approximately 15 previous versions of itself that, for whatever reason, never got cleaned up.</li>
<li>She has three Chrome profiles; one for each of her two jobs and one for personal browsing. Each of those was between 1 and 3GB—I’m still not entirely sure <em>why</em>, as best I can tell it’s various caches.</li>
<li>Microsoft Teams, despite somehow having a 1.2GB main app bundle, was storing a further 1.5GB of caches and other files.</li>
<li>Backblaze internal files totalling 12GB. I actually already knew about this, as I’d ran across it before and discovered that <a href="https://www.reddit.com/r/backblaze/comments/ay1d14/comment/eicz7fl/">it’s by design</a>. Backblaze’s logs of processed files are append-only, and their recommended solution is to just…abandon your backup every few years and push everything completely from scratch. I generally find Backblaze to be a great product, but this always felt like a huge miss to me.</li>
<li>Time Machine local snapshots were taking up around 40GB total. This is supposedly purgeable space that is freed up as it’s needed but…well, more on that below.</li>
</ul>
<p>I then ran it on my own machine as, despite having a 512GB drive, I had much less storage free than I felt like I should given the relatively limited number of files I keep on the machine. I have a lot of developer tools which I know get pretty bloated, but even so:</p>
<ul>
<li>10GB of old versions of JetBrains tools. I had the setting enabled in JetBrains Toolbox to keep the last version installed to allow for instant rollback, but that doesn’t explain why I had stuff dating back to 2022. Thankfully there is a UI inside the app itself to clear these out.</li>
<li>16GB of those fancy aerial wallpapers that were originally from the Apple TV. This one is sort of on me, given that I deliberately enabled the setting to cycle through them all. But, as far as I can see, there’s no way whatsoever to delete them from the same UI their downloads are triggered from (the Screen Saver area of System Settings). To remove them, I had to find them in <code>/Library/Application Support/com.apple.idleassetsd/Customer/4KSDR240FPS/</code> and delete the files. Real user friendly.</li>
<li>rustup, which I had installed to briefly play around with Rust, had installed 1.5GB of HTML documentation.</li>
<li>My NPM cache was 5GB. Actually I’m not surprised by this at all; the entire Node and NPM ecosystem is a fucking mess and I am more surprised every day that it has not exploded spectacularly since <code>left-pad</code>.</li>
<li>Something like 35GB of old iOS Simulators for Xcode. I appreciate that a professional iOS developer might need to keep the sims around for every point release of iOS, but is it too much to ask for a prompt or a setting to automatically clean up the old versions when new ones are installed? At least you can delete these from a UI in Xcode itself.</li>
<li>60GB of local Time Machine snapshots</li>
</ul>
<p>I can appreciate that in a world of multi-hundred-gigabyte to multi-terabyte disks, griping about a handful of single-digit GB caches seems silly. But when seemingly every large software vendor rolls with the “it’s free real estate” attitude, it can and does add up—to the point where an entry-level machine ends up largely full of stuff that, as far as a typical user is a concerned, is not their files.</p>
<p>When a computer runs out of RAM everything gets slow; when it runs out of disk, things <em>break</em>, in ways that <a href="https://sixcolors.com/post/2024/03/a-disk-so-full-it-couldnt-be-restored/">can be difficult to recover from</a>. Again, more on that below.</p>
<p>To quote my wife, “what was I supposed to do if I wasn’t married to a nerd?”—and she’s completely right! Dragging Chrome.app and Teams.app to the trash would have done nothing to clean up the even-larger-still caches sitting there in some obscure system directory.</p>
<h2>Addendum: Does anyone at Apple still work on Time Machine?</h2>
<p>Time Machine under macOS Sonoma is just knackered.</p>
<p>If you use Time Machine, do a backup and let it finish. Then, close all your applications, quit any background applications you know are running, then just let your machine idle for an hour. Do another backup after that hour, and there’s a good chance Time Machine will claim to find tens of thousands of changes and then proceed to very slowly copy between several hundred MB and a few GB to your backup disk. Every. Single. Hour.</p>
<p>Ascertaining the real size of files on Macs, particularly APFS-formatted drives, <a href="https://eclecticlight.co/2024/05/08/how-accurate-are-the-finders-folder-and-volume-sizes/">is</a> <a href="https://eclecticlight.co/2024/01/03/what-should-we-know-about-apfs-special-files/">notoriously</a> <a href="https://eclecticlight.co/2023/12/25/where-are-the-sanity-checks/">difficult</a>, but I can see the free disk space on my backup drive ticking down—stuff is actually being written.</p>
<p>I know there’s system-level stuff going on in the background that will account for <em>some</em> changes, even if you’re not actively using the computer. But there’s nothing beyond bugs that should account for that volume of data changing.</p>
<p>Next up: local snapshots. As I mentioned above, this is considered purgeable space by macOS, to be freed up when needed. Well, it doesn’t work very well.</p>
<p>Last month, I was downloading a ~150GB torrent. I intended to move it immediately off to a network drive after completion, Finder told me I had about 220GB free, and I was downloading to a folder excluded from Time Machine as I have no need for it to be part of my main backup. To me, this seemed totally fine.</p>
<p>Imagine my alarm then when I checked up on things after 30 mins to find that the download had stopped due to insufficient disk space. Random apps I had open were popping up scary warnings, and <code>df</code> was reporting 100% usage of my main Data volume (where user files are stored in modern macOS).</p>
<p>I suspected local snapshots were to blame, but <code>tmutil</code> commands were hanging, and I feared that if I tried to reboot the machine I wouldn’t be able to get back into it. I eventually found around a GB of build files I could regenerate, deleted them to free up some space, and was then able to run <code>tmutil listlocalsnapshots</code> and <code>tmutil deletelocalsnapshots</code> to clear out what was there, and whaddayaknow: everything immediately worked fine again.</p>
<p>APFS snapshots operate independently of Time Machine exclusions, so it’s no surprise that changes to a directory excluded from backup would still result in snapshots, but that does not change the fact that <em>this should not happen</em>. There should be no circumstance in which a file transfer that should leave 70GB of free disk space instead results in the system becoming so full that it’s borderline inoperable.</p>
<p>So now I’m in a bit of a dilemma. I’ve long worked under the “two is one, one is none” mantra for backups, with one on-site and one off-. But I trust Time Machine so little now that I’m not even sure it <em>would</em> successfully recover my data if I needed it to. Maybe time to finally give Carbon Copy Cloner or SuperDuper a try.</p>
</section>
</article>
</main>

    <footer class="footer-background pb-8 text-center text-xs text-gray-700 dark:text-gray-400">
      <nav class="flex items-center justify-around">
        <a rel="me" href="https://mastodon.social/@mpbarlow" target="_blank" title="Toot me on Mastodon" class="group">
  <img
    src="/img/mastodon.png"
    srcset="/img/mastodon_2x.png 2x, /img/mastodon_3x.png 3x"
    alt="A pixel art elephant bearing the Mastodon logo"
    class="h-[64px] w-[64px] group-hover:hidden"
  />
  <img
    src="/img/mastodon_selected.png"
    srcset="/img/mastodon_selected_2x.png 2x, /img/mastodon_selected_3x.png 3x"
    alt="A pixel art elephant bearing the Mastodon logo"
    class="hidden h-[64px] w-[64px] group-hover:inline"
  />
</a>
 <a href="https://www.instagram.com/mattpbarlow" target="_blank" title="Dog pix" class="group">
  <img
    src="/img/instagram.png"
    srcset="/img/instagram_2x.png 2x, /img/instagram_3x.png 3x"
    alt="A pixel art iPhone taking a photo of the Instagram logo"
    class="h-[64px] w-[64px] group-hover:hidden"
  />
  <img
    src="/img/instagram_selected.png"
    srcset="/img/instagram_selected_2x.png 2x, /img/instagram_selected_3x.png 3x"
    alt="A pixel art iPhone taking a photo of the Instagram logo"
    class="hidden h-[64px] w-[64px] group-hover:inline"
  />
</a>
 <a href="https://github.com/mpbarlow" target="_blank" title="Fork me on GitHub" class="group">
  <img
    src="/img/github.png"
    srcset="/img/github_2x.png 2x, /img/github_3x.png 3x"
    alt="A pixel art MacBook displaying the Git logo"
    class="h-[64px] w-[64px] group-hover:hidden"
  />
  <img
    src="/img/github_selected.png"
    srcset="/img/github_selected_2x.png 2x, /img/github_selected_3x.png 3x"
    alt="A pixel art MacBook displaying the Git logo"
    class="hidden h-[64px] w-[64px] group-hover:inline"
  />
</a>

      </nav>
      <p class="mt-8">&copy; MMXXIV Matt Barlow</p>
    </footer>
  </body>
</html>
